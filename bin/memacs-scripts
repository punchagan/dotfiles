#!/bin/bash
set -e
source $HOME/.virtualenvs/hs/bin/activate

MEMACS_DIR=$HOME/.life-in-plain-text/memacs

if [ `acpi -a|grep -o "off-line"` ]
then
    echo "Not connected to power."
    exit
fi

# Kindle history
KINDLE_MOUNT_DIR=/tmp/kindle-ssh-mount
KINDLE_MSG_DIR=/tmp/kindle-msg-dir
export PYTHONPATH=$HOME/software/random/kindle-utils

touch "${MEMACS_DIR}"/kindle.org
get-kindle-logs "${KINDLE_MOUNT_DIR}" "${KINDLE_MSG_DIR}"
memacs-kindle "${KINDLE_MSG_DIR}" \
              -o "${MEMACS_DIR}"/kindle.org_archive \
              -b "${KINDLE_MOUNT_DIR}"/mnt/us/documents/ \
              --add-to-time-stamps "+5.5" \
              -a

# Browser history.
touch "${MEMACS_DIR}"/chromium.org
memacs-chromium -o "${MEMACS_DIR}"/chromium.org_archive \
                -c $HOME/.memacs/preferences.ini \
                -a

# Git history
touch "${MEMACS_DIR}"/git.org
scan-git-repos "${MEMACS_DIR}"/git.org_archive punchagan
