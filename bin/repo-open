#!/bin/bash

# Navigate to the root of the repo
top=`git rev-parse --show-toplevel`
pushd $top

while getopts ":n:d" opt; do
  case $opt in
    d)
      #echo "Opening files with uncommitted changes too" >&2;
      # Get list of all files with uncommitted changes.
      edited=`git status --porcelain |grep "\(^ M\|^A\)"|cut -d " " -f 3`
      ;;
    n)
      #echo "Opening files in last" $OPTARG "commits" >&2;
      n=$OPTARG
      ;;
    \?)
      echo "Invalid option: -$OPTARG" >&2
      ;;
  esac
done

# Remove all processed arguments
shift $((OPTIND-1))

editor=$@

# 
if [ -z $n ] && [ -z $edited ]; then
n=1;
else 
  if [ -z $n ]; then
    n=0;
  fi
fi

# Get latest $2 number of commits
committed=$(git diff-tree HEAD~$n HEAD --name-only -r)

#echo "Opening files" $edited $committed in $editor
$editor $edited $committed

popd
