#!/bin/bash

DAY="${1:-last Friday}"
WEEK=$(date -d "${DAY}" '+%U')
YEAR=$(date -d "${DAY}" '+%G')
DIR="${HOME}/code/segfault/admin/weekly/${YEAR}/${WEEK}"
WEEKLY="${DIR}/$(whoami).md"

echo "Generating weekly for week ${WEEK} (in ${YEAR})..."
opam switch okra
eval "$(opam env)"
mkdir -p "${DIR}"
okra generate --week="${WEEK}" > "${WEEKLY}"
echo "Generated ${WEEKLY}"
