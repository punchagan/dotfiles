#!/usr/bin/env bash
# Script to switch between night and day modes in different programs
set -euo pipefail
IFS=$'\n\t'

# Settings
EMACS_DAY_THEME=spacemacs-light
EMACS_NIGHT_THEME=spacemacs-dark
GTK_DAY_THEME="'Yaru-light'"
GTK_NIGHT_THEME="'Yaru-dark'"

GTK_THEME=$(gsettings get org.gnome.desktop.interface gtk-theme)
if [ "${GTK_THEME}" == ${GTK_NIGHT_THEME} ]; then
    # Currently in dark mode
    CURRENT_MODE="night"
    GUESSED_MODE="day"
else
    CURRENT_MODE="day"
    GUESSED_MODE="night"
fi

MODE="${1:-${GUESSED_MODE}}"
if [ ${CURRENT_MODE} == ${MODE} ]; then
    echo "Already in ${MODE} mode. Nothing to do!"
    exit 1
fi
echo "Switching to ${MODE} mode..."

function day {
    # Emacs
    emacsclient -n -e "(load-theme '${EMACS_DAY_THEME} t)"
    # Gnome shell
    gsettings set org.gnome.desktop.interface gtk-theme ${GTK_DAY_THEME}
}

function night {
    # Emacs
    emacsclient -n -e "(load-theme '${EMACS_NIGHT_THEME} t)"
    # Gnome shell
    gsettings set org.gnome.desktop.interface gtk-theme ${GTK_NIGHT_THEME}
}

"${MODE}"
slack-switch-day-night "${MODE}"
zulip-switch-day-night ~/.zulip.d/ "${MODE}"
